{% extends "fwpcore.html" %}



{% block title %}

    {% if mode == 'modeledit' %}
        Gestione modello
    {% endif %}

    {% if mode == 'mapview' %}
        Visualizzazione dati
    {% endif %}

    {% if mode == 'mapedit' %}
        Modifica mappe
    {% endif %}

    {% if mode == 'full' %}
        Area di lavorazione
    {% endif %}

{% endblock %}


{% block headers %}

    <script src="http://maps.google.com/maps/api/js?v=3.2&sensor=false" xmlns="http://www.w3.org/1999/html"></script>
    <script language="JavaScript" src="{{ STATIC_URL }}mapvisng.js"></script>

    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}fwstui.css">
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}mapvisng.css">
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}gis.css">

{% endblock %}


{% block navigation %}



<div id="proxyinfo">

    {% if proxy_type != 'local' %}
        {% if proxy_type != 'linked' %}
            Proxy
        {% else %}
            Proxy standalone
        {% endif %}
    {% else %}
        Piattaforma standalone
    {% endif %}

    <span class="proxytitle">{{ proxy_name }}</span>

</div>


<div id="operations">


    {% if mode != 'mapview' %}

    <div class="flexmenu" id="opsmenu">

        <div class="submenu">Mappa
            {% if mode == 'full' %}
            <div class="menuopt" id="menu_createnewmap">Nuova</div>
            <div class="menuopt" id="menu_loadmap">Carica</div>
            {% endif %}
            {% if mode == 'full' or mode == 'mapedit' %}
            <div class="menuopt" id="menu_integratemap">Combina mappa</div>
            {% endif %}
            <div class="menuopt" id="menu_integratemodel">Combina modello</div>
            <div class="menuopt" id="menu_savemap">Salva</div>
        </div>
        {% if mode == 'full' or mode == 'mapedit' %}
            <div class="submenu">Strumenti
                <div class="menuopt" id="menu_geoshift">Sposta</div>
                <div class="menuopt" id="menu_loadsnapmap">Carica riferimento</div>
                <div class="menuopt" id="menu_filter">Filtra</div>
            </div>
        {% endif %}
        {% if mode == 'full' or mode == 'mapedit' %}
            <div class="submenu">Mostra
                <div class="menuopt" id="menu_showmap">Mappa</div>
                <div class="menuopt" id="menu_showmodel">Modello</div>
            </div>
        {% endif %}
    </div>

    {% endif %}



</div>


    <!-- map details, temporary -->
    <div id="mapdetails">
    {% if mode == 'mapview' or mode == 'mapedit' or model == 'modeledit' %}
        <span class="proxytitle">{% if meta_id == ".st" %}Area di lavorazione{% else %}{{ meta_id }}{% endif %}: {{ map_id }}</span>
    {% endif %}
    </div>

    <div id="featurecard">

        {%  if mode == 'mapedit' or mode == 'full' %}
            <input type="button" id="button_removefeature" value="Elimina oggetto">
        {% endif %}

        <div id="featuredetails"></div>


        <table id="featuredesc">
            <thead>
                <tr>
                    <td>Campo</td>
                    <td>Valore</td>
                    <td></td>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>


    </div>






{% endblock %}




{% block functionality %}


<div id="form_loadmap" title="Caricamento mappe">

    <input type="file" id="uploadfield" accept="application/zip">


    <div class="formbriefing">
        Selezionare una mappa esistente o un file sul disco dell'utente.<br>
        Il sistema accetta mappe in formato Shapefile, GeoJSON o MapInfo.<br>
        La mappa deve essere archiviata in un singolo file Zip e contenere un solo tipo di oggetto geografico (tratta o punto).
    </div>


    <select id="newmap_load">
        <option value=""></option>
        <optgroup  id="newmap_section_fromfile" label="Da file">
            <option value=".file" id="newmap_load_fromfile">Seleziona...</option>
        </optgroup>

        {% for meta_id, maplist in proxy_maps.items %}
            <optgroup label="{% if meta_id == ".st" %}Area di lavorazione{% else %}{{ meta_id }}{% endif %}">
                {% for map_id, mapdata in maplist.items %}
                <option value="{{ meta_id }}/{{ map_id }}">{{ map_id }}</option>
                {% endfor %}
            </optgroup>
        {% endfor %}

    </select>


    <div class="formwarning" id="warning_maploadlosechanges">
        <span class="warninglabel">Attenzione</span>: eventuali modifiche non salvate andranno perdute.
    </div>

    <div class="formwarning" id="warning_maploadoverwrite">
        <span class="warninglabel">Attenzione</span>: esiste già una mappa con questo nome. I dati esistenti per questa mappa nell'area di lavorazione verranno sovrascritti.
    </div>

    <div class="formwarning" id="warning_maploadwrongformat">
        <span class="warninglabel">Attenzione</span>: formato del file non valido.
    </div>


</div>


<div id="progress_upload" title="Invio dati">

    <div class="progspinner" id="progspinner_upload">
        <img src="/static/resource/progressbar.gif">
    </div>

    <div class="progressinfo" id="progress_stage_uploading">
        Invio dei dati in corso...
    </div>

    <div class="progressinfo feedback_good" id="uploadfinished_success">
        Dati inviati con successo.
    </div>

    <div class="progressinfo feedback_bad" id="uploadfinished_fail">
        Invio dei dati fallito.
        <div id="uploadfail_explain">
        </div>
    </div>

</div>


<div id="progress_mapload" title="Caricamento dati">

    <div class="progspinner" id="progspinner_mapload">
        <img src="/static/resource/progressbar.gif">
    </div>

    <div class="progressinfo" id="progress_stage_maploading">
        Caricamento dei dati in corso...
    </div>

    <div class="progressinfo" id="progress_stage_rendering">
        Elaborazione mappa in corso...
    </div>

    <div class="progressinfo feedback_good" id="maploadfinished_success">
        Dati caricati con successo.
    </div>

    <div class="progressinfo feedback_bad" id="maploadfinished_fail">
        Caricamento dati fallito.
        <div id="maploadfail_explain">
        </div>
    </div>



    <div class="formwarning" id="warning_maploadrenderissues">
        <span class="warninglabel">Attenzione</span>: alcuni oggetti della mappa hanno causato anomalie durante il processo di rendering.
    </div>


</div>





    <div id="modelview">

        <table id="modelstruct">
            <thead>
                <tr>
                    <td>Campo</td>
                    <td>Valori consigliati</td>
                    <td></td>
                </tr>
            </thead>
            <tbody>

            </tbody>
            <tfoot>
                <tr>
                    <td><input type="text" id="model_newpropname"></td>
                    <td colspan=2><input type="button" id="model_addnewprop" value="Aggiungi proprietà"></td>
                </tr>
            </tfoot>

        </table>


    </div>

    <div id="mapview"></div>



{% endblock %}


{% block contextguide %}

    <div class="help">
        WORK IN PROGRESS
    </div>


{%  endblock %}


{% block starterscript %}
    <script>
        pageInit('{{ proxy_id }}', '{{ meta_id }}', '{{ map_id }}', '{{ mode }}', '{{ proxy_type }}', {{ manifest }}, {{ mapsforjs }});
    </script>

{% endblock %}