{% extends "fwpcore.html" %}



{% block title %}

    {% if mode == 'modeledit' %}
        Gestione modello
    {% endif %}

    {% if mode == 'mapview' %}
        Visualizzazione dati
    {% endif %}

    {% if mode == 'mapedit' %}
        Modifica mappe
    {% endif %}

    {% if mode == 'full' %}
        Area di lavorazione
    {% endif %}

{% endblock %}


{% block headers %}

    <script src="http://maps.google.com/maps/api/js?v=3.2&sensor=false" xmlns="http://www.w3.org/1999/html"></script>
    <script language="JavaScript" src="{{ STATIC_URL }}mapvisng.js"></script>

    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}fwstui.css">
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}mapvisng.css">
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}gis.css">

{% endblock %}


{% block navigation %}



<div id="proxyinfo">


    <a title="Riepilogo istanza" href="/fwp/proxyng/{{ proxy_id }}/" class="backtrack"><img src="/static/resource/fwp_backtrack.png"></a>

    {% if proxy_type != 'local' %}
        {% if proxy_type != 'linked' %}
            Proxy
        {% else %}
            Proxy standalone
        {% endif %}
    {% else %}
        Piattaforma standalone
    {% endif %}

    <span class="proxytitle">{{ proxy_name }}</span>

</div>


<div id="operations">


    <!-- to be removed -->


</div>


    <!-- map details, temporary -->
    <div id="mapdetails">
    {% if mode == 'mapview' or mode == 'mapedit' or model == 'modeledit' %}
        <span class="proxytitle">{% if meta_id == ".st" %}Area di lavorazione{% else %}{{ meta_id }}{% endif %}: {{ map_id }}</span>
    {% endif %}
    </div>

    <div id="featurecard">

        {%  if mode == 'mapedit' or mode == 'full' %}
            <input type="button" id="button_removefeature" value="Elimina oggetto">
        {% endif %}

        <div id="featuredetails"></div>


        <table id="featuredesc">
            <thead>
                <tr>
                    <td>Campo</td>
                    <td>Valore</td>
                    <td></td>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>


    </div>






{% endblock %}




{% block functionality %}


<div id="form_loadmap" title="Caricamento mappe">

    <input type="file" id="uploadfield" accept="application/zip">


    <div class="formbriefing">
        Selezionare una mappa esistente o un file sul disco dell'utente.<br>
        Il sistema accetta mappe in formato Shapefile, GeoJSON o MapInfo.<br>
        La mappa deve essere archiviata in un singolo file Zip e contenere un solo tipo di oggetto geografico (tratta o punto).
    </div>


    <select id="newmap_load">
        <option value=""></option>
        <optgroup  id="newmap_section_fromfile" label="Da file">
            <option value=".file" id="newmap_load_fromfile">Seleziona...</option>
        </optgroup>

        {% for cmeta_id, maplist in proxy_maps.items %}
            <optgroup label="{% if cmeta_id == ".st" %}Area di lavorazione{% else %}{{ cmeta_id }}{% endif %}">
                {% for map_id, mapdata in maplist.items %}
                <option value="{{ cmeta_id }}/{{ map_id }}">{{ map_id }}</option>
                {% endfor %}
            </optgroup>
        {% endfor %}

    </select>


    <div class="formwarning" id="warning_maploadlosechanges">
        <span class="warninglabel">Attenzione</span>: eventuali modifiche non salvate andranno perdute.
    </div>

    <div class="formwarning" id="warning_maploadoverwrite">
        <span class="warninglabel">Attenzione</span>: esiste già una mappa con questo nome. I dati esistenti per questa mappa nell'area di lavorazione verranno sovrascritti.
    </div>

    <div class="formwarning" id="warning_maploadwrongformat">
        <span class="warninglabel">Attenzione</span>: formato del file non valido.
    </div>


</div>


<div id="progress_upload" title="Invio dati">

    <div class="progspinner" id="progspinner_upload">
        <img src="/static/resource/progressbar.gif">
    </div>

    <div class="progressinfo" id="progress_stage_uploading">
        Invio dei dati in corso...
    </div>

    <div class="progressinfo feedback_good" id="uploadfinished_success">
        Dati inviati con successo.
    </div>

    <div class="progressinfo feedback_bad" id="uploadfinished_fail">
        Invio dei dati fallito.
        <div id="uploadfail_explain">
        </div>
    </div>

</div>


<div id="progress_mapload" title="Caricamento dati">

    <div class="progspinner" id="progspinner_mapload">
        <img src="{{ STATIC_URL }}resource/progressbar.gif">
    </div>

    <div class="progressinfo" id="progress_stage_maploading">
        Caricamento dei dati in corso...
    </div>

    <div class="progressinfo" id="progress_stage_rendering">
        Elaborazione mappa in corso...
    </div>

    <div class="progressinfo feedback_good" id="maploadfinished_success">
        Dati caricati con successo.
    </div>

    <div class="progressinfo feedback_bad" id="maploadfinished_fail">
        Caricamento dati fallito.
        <div id="maploadfail_explain">
        </div>
    </div>



    <div class="formwarning" id="warning_maploadrenderissues">
        <span class="warninglabel">Attenzione</span>: alcuni oggetti della mappa hanno causato anomalie durante il processo di rendering.
    </div>


</div>


<div id="form_datasave" title="Salvataggio dati">

    <div class="formbriefing">
        Selezionare un nome per il salvataggio dei dati.<br>
        I dati possono essere salvat nell'area di lavorazione (impostazione standard) o nell'archivio pubblico.
    </div>

    <div class="formbriefing">
        <input type="text" value="{{ map_id }}" id="savemapto_filename">
        <select id="savemapto_dest">
            {% for cmeta_id, maplist in proxy_maps.items %}
                <option value="{{ cmeta_id }}" {% if meta_id  == cmeta_id %}selected{% endif %}>{% if cmeta_id == ".st" %}Area di lavorazione{% else %}{{ cmeta_id }}{% endif %}</option>
            {% endfor %}
        </select>
    </div>


    <div class="formwarning" id="warning_mapsaveoverwrite">
        <span class="warninglabel">Attenzione</span>: esistono già dati con questo nome. I dati esistenti verranno sovrascritti.
    </div>


</div>


<div id="progress_datasave" title="Salvataggio dati">

    <div class="progspinner" id="progspinner_datasave">
        <img src="/static/resource/progressbar.gif">
    </div>

    <div class="progressinfo" id="progress_stage_datasaving">
        Salvataggio dei dati...
    </div>

    <div class="progressinfo feedback_good" id="datasave_success">
        Salvataggio completato.
    </div>

    <div class="progressinfo feedback_bad" id="datasave_fail">
        Salvataggio fallito.
        <div id="datasavefail_explain">
        </div>
    </div>

</div>




<div id="modelview">

        <table id="modelstruct">
            <thead>
                <tr>
                    <td>Campo</td>
                    <td>Valori consigliati</td>
                    <td></td>
                </tr>
            </thead>
            <tbody>

            </tbody>
            <tfoot>
                <tr>
                    <td><input type="text" id="model_newpropname"></td>
                    <td colspan=2><input type="button" id="model_addnewprop" value="Aggiungi proprietà"></td>
                </tr>
            </tfoot>

        </table>


    </div>


    <div id="standalonebar">


        <span id="appcontrolsbar">

        {% if mode != 'mapview' %}

            {% if mode == 'full' %}
                <img src="{{ STATIC_URL }}resource/fwp_newmapedit.png" class="imgbutton" id="menu_createnewmap" title="Crea nuova mappa">
                <img src="{{ STATIC_URL }}resource/fwp_editmap.png" class="imgbutton" id="menu_loadmap" title="Carica una mappa">
            {% endif %}

            {% if mode == 'full' or mode == 'mapedit' %}
                <img src="{{ STATIC_URL }}resource/visng_menu_integratemap.png" class="imgbutton menuopt" id="menu_integratemap" title="Combina una mappa">
            {% endif %}

            <img src="{{ STATIC_URL }}resource/visng_menu_integratemodel.png" class="imgbutton menuopt" id="menu_integratemodel" title="Combina un modello">

            {% if mode == 'full' or mode == 'mapedit' %}

                <img src="{{ STATIC_URL }}resource/visng_layers.png" class="imgbutton menuopt" id="menu_loadsnapmap" title="Carica un riferimento">
            {% endif %}

            <img src="{{ STATIC_URL }}resource/visng_menu_savemap.png" class="imgbutton menuopt" id="menu_savemap" title="Salva">



            {% if mode == 'full' or mode == 'mapedit' %}
                <img src="{{ STATIC_URL }}resource/visng_menu_geoshift.png" class="imgbutton menuopt" id="menu_geoshift" title="Trasla mappa">
                <img src="{{ STATIC_URL }}resource/visng_menu_filter.png" class="imgbutton menuopt" id="menu_filter" title="Evidenzia entità">
            {% endif %}

            {% if mode == 'full' or mode == 'mapedit' %}
                <img src="{{ STATIC_URL }}resource/visng_menu_viewmodel.png" class="imgbutton menuopt" id="menu_showmodel" title="Visualizza modello">
                <img src="{{ STATIC_URL }}resource/visng_menu_viewmap.png" class="imgbutton menuopt" id="menu_showmap" title="Visualizza mappa">

            {% endif %}
            </span>

        {% endif %}

    <!-- TODO: ENABLE

        <span id="mapcontrolsbar">
            <img src="{{ STATIC_URL }}resource/visng_controls_reposition.png" class="imgbutton mapcontrol" id="mapcontrols_repos" title="Riposiziona la mappa">
            {% if mode == 'full' or mode == 'mapedit' %}
                <img src="{{ STATIC_URL }}resource/visng_controls_measure.png" class="imgbutton mapcontrol" id="mapcontrols_measure" title="Crea entità">
            {% endif %}
        <img src="{{ STATIC_URL }}resource/visng_controls_editfeature.png" class="imgbutton mapcontrol" id="mapcontrols_editfeature" title="Seleziona entità">
            {% if mode == 'full' or mode == 'mapedit' %}
                <img src="{{ STATIC_URL }}resource/visng_controls_newfeature.png" class="imgbutton mapcontrol" id="mapcontrols_createfeature" title="Crea entità">
            {% endif %}
        </span>
    -->

    </div>
    <div id="mapview"></div>



{% endblock %}


{% block contextguide %}

    <div class="help">
        WORK IN PROGRESS
    </div>


{%  endblock %}


{% block starterscript %}
    <script>
        pageInit('{{ proxy_id }}', '{{ meta_id }}', '{{ map_id }}', '{{ mode }}', '{{ proxy_type }}', {{ manifest }}, {{ mapsforjs }});
    </script>

{% endblock %}